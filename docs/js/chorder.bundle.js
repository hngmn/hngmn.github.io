(()=>{"use strict";var e,t={5795:(e,t,n)=>{var s=n(7294),r=n(3935);function i(e){const{n:t}=e;return s.createElement("button",{onClick:()=>console.log("click ",t)},"Slot")}function o(){return s.createElement("section",null,s.createElement("p",null,"Looper"),s.createElement("span",null,s.createElement(i,{n:1}),s.createElement(i,{n:2}),s.createElement(i,{n:3}),s.createElement(i,{n:4})))}var a=n(6486),l=n(1950);function u(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,c(e,t,"get"))}function c(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}const h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],d=["-2","-1","0","1","2","3","4","5","6","7","8"].map((e=>h.map((t=>`${t}${e}`)))).flat().slice(0,128),p={};for(const[e,t]of d.entries())p[t]=e;var g=new WeakMap;class f{constructor(e){g.set(this,{writable:!0,value:void 0}),function(e,t,n){(function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}})(e,c(e,t,"set"),n)}(this,g,e)}getValue(){return u(this,g)}noteString(){return d[u(this,g)]}up(e=1){return this.step(e)}step(e=1){return new f(u(this,g)+e)}octave(e=1){return new f(u(this,g)+12*e)}static from(e){return new f(p[e])}static diff(e,t){return Math.abs(u(t,g)-u(e,g))}}function w(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,v(e,t,"get"))}function y(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,v(e,t,"set"),n),n}function v(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}const m=[2,2,1,2,2,2,1],E=[2,1,2,2,1,2,2];var b,k,O,P=new WeakMap,S=new WeakMap,L=new WeakMap;class j{constructor(e,t){P.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),L.set(this,{writable:!0,value:void 0}),y(this,P,e),y(this,S,t),y(this,L,[e]);let n=e;for(const e of t)n=n.up(e),w(this,L).push(n);w(this,L).pop()}static major(e){return new j(e,m)}static minor(e){return new j(e,E)}static aeolian(e){return new j(e,w(j.CMAJOR.mode(6),S))}at(e){const t=e-1;return w(this,L)[t%w(this,L).length].octave(Math.floor(t/w(this,L).length))}getRoot(){return w(this,P)}getIntervals(){return w(this,S)}getNotes(){return w(this,L)}transpose(e){return new j(w(this,P).step(e),w(this,S))}mode(e){const t=e-1;return new j(this.at(e),[w(this,S).slice(t),w(this,S).slice(0,t)].flat())}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}b=j,k="CMAJOR",O=j.major(f.from("C4")),k in b?Object.defineProperty(b,k,{value:O,enumerable:!0,configurable:!0,writable:!0}):b[k]=O;class D{constructor(){C(this,"on",void 0),this.on=!1}set(e){return this.on=e}toggle(){return this.on=!this.on}}class M{constructor(e){C(this,"value",void 0),C(this,"n",void 0),this.value=0,this.n=e}set(e){return this.value=e}cycle(){return this.value=(this.value+1)%this.n}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A{constructor(){T(this,"synth",void 0),T(this,"scale",void 0),T(this,"transposition",void 0),T(this,"degree",void 0),T(this,"augdim",void 0),T(this,"sus",void 0),T(this,"voicings",void 0),T(this,"notesPlaying",void 0),this.synth=new l.PolySynth(l.Synth,{oscillator:{type:"sine"}}).toDestination(),this.notesPlaying=[],this.scale=j.CMAJOR,this.transposition=0,this.degree=1,this.voicings={root:[new D,new D,new D],mid:[new D,new D,new D],high:[new D,new D,new D]},this.augdim=new D,this.sus=new M(3),this.playNotes=(0,a.debounce)(this.playNotes,A.DEBOUNCE_MS)}getRoot(){return this.scale.at(this.degree).up(this.transposition)}playNote(e){this.notesPlaying.map((e=>e.noteString())).includes(e.noteString())||this.synth.triggerAttack(e.noteString(),l.now())}playNotes(e){const t=e.toPlay.map((e=>e.noteString())),n=[];for(const e of this.notesPlaying)t.includes(e.noteString())||n.push(e.noteString());this.synth.triggerRelease(n,l.now()),e.toPlay.forEach((e=>{this.playNote(e)})),this.notesPlaying=e.toPlay}update(){const e={root:this.scale.at(this.degree),mid:this.scale.at(this.degree+2),high:this.scale.at(this.degree+4),toPlay:[]};1===this.sus.value?e.mid=this.scale.at(this.degree+1):2===this.sus.value&&(e.mid=this.scale.at(this.degree+3)),this.augdim.on&&(4===f.diff(e.root,e.mid)?e.high=e.high.up(1):e.high=e.high.step(-1));for(let t=0;t<3;t++)this.voicings.root[t].on&&e.toPlay.push(e.root.octave(t-1)),this.voicings.mid[t].on&&e.toPlay.push(e.mid.octave(t-1)),this.voicings.high[t].on&&e.toPlay.push(e.high.octave(t-1));return e.toPlay=e.toPlay.map((e=>e.up(this.transposition))),this.playNotes(e),e.toPlay}setDegree(e){return this.degree=e,this.degree}transpose(e){return this.transposition+=e,this.transposition}}function N(e){const t=(0,s.useMemo)((()=>{console.log("initializing keysState. This should only run once.",e);const t={};for(const n of e)t[n]=!1;return{isPressed:t,pressedOrder:[]}}),[e]),[n,r]=(0,s.useReducer)(K,t);return(0,s.useEffect)((()=>{const e=({key:e})=>{r(x.down(e))},t=({key:e})=>{r(x.up(e))};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),n}T(A,"DEBOUNCE_MS",60);const G={DOWN:"down",UP:"up"},x={down:e=>({type:G.DOWN,payload:e}),up:e=>({type:G.UP,payload:e})};function K(e,t){const n=t.payload;if(!(n in e.isPressed))return e;switch(t.type){case G.DOWN:if(e.isPressed[n]){if(e.pressedOrder[e.pressedOrder.length-1]===n)return e;e.pressedOrder=e.pressedOrder.filter((e=>e!==n))}else e.isPressed[n]=!0;return e.pressedOrder.push(n),e.lastKeyAction=t,{...e};case G.UP:return e.isPressed[n]?(e.isPressed[n]=!1,e.pressedOrder=e.pressedOrder.filter((e=>e!==n)),e.lastKeyAction=t):console.warn(`Got keyup '${n}' but it's not marked pressed`),{...e};default:throw new Error(`Unexpected Key Action type ${t.type}`)}}const R={TOGGLE:"Toggle",HOLD:"Hold"};function W(e,t,n){const r=function(e,t,n,r){const[i,o]=(0,s.useState)([]),a=N((0,s.useMemo)((()=>Object.keys(e)),[e]));return(0,s.useEffect)((()=>{if(t===R.TOGGLE)a.lastKeyAction&&a.lastKeyAction.type===G.DOWN&&o((t=>{const n=a.lastKeyAction.payload;if(t.indexOf(e[n])>=0){const s=t.filter((t=>t!==e[n]));return s.push(e[n]),s}const s=[...t,e[n]];return s.length>1&&s.shift(),s}));else{if(t!==R.HOLD)throw new Error(`useMultiSwitch: Unexpected BindingMode ${t}`);a.pressedOrder.length>1?o(a.pressedOrder.map((t=>e[t])).slice(a.pressedOrder.length-1)):o(a.pressedOrder.map((t=>e[t])))}}),[e,t,1,a]),(0,s.useEffect)((()=>{if(r)return r(i)})),i}(e,t,0,(0,s.useCallback)((e=>{if(e.length>1)throw new Error("singleStateCallback: states array greater than 1");1===e.length&&n&&n(e[0])}),[n]));return r[0]}function _(e,t){const[n,r]=(0,s.useState)(!1),i=(0,s.useCallback)((({key:s})=>{s!==e||n||(r(!0),t(!0))}),[e,t,n]),o=(0,s.useCallback)((({key:n})=>{n===e&&(r(!1),t(!1))}),[e,t]);return(0,s.useEffect)((()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",o)})),[o,i]),n}const U=new A,$={a:1,s:2,d:3,f:4,q:5,w:6,e:7},F={c:1,v:2};function H(){const[e,t]=s.useState([]),[n,r]=s.useState(0),i=e=>{t(e.sort(((e,t)=>e.getValue()-t.getValue())).map((e=>e.noteString())))},o=W($,R.TOGGLE);s.useEffect((()=>{o&&(U.setDegree(o),i(U.update()))}),[o]);const a=s.useCallback((e=>{U.augdim.set(e),i(U.update())}),[]);!function(e,t=R.TOGGLE,n=!1,r){const[i,o]=(0,s.useState)(n),a=N((0,s.useMemo)((()=>[e]),[e]));(0,s.useEffect)((()=>{if(t===R.TOGGLE)a.lastKeyAction&&a.lastKeyAction.type===G.DOWN&&o((e=>!e));else{if(t!==R.HOLD)throw new Error(`useSingleKeySwitch: Unexpected BindingMode ${t}`);o(a.isPressed[e])}}),[e,t,a]),(0,s.useEffect)((()=>{r&&r(i)}),[r,i])}("b",R.HOLD,!1,a);const l=W(F,R.HOLD);s.useEffect((()=>{console.log(`updating sus: ${l}`),l?(U.sus.set(l),i(U.update())):(U.sus.set(0),i(U.update()))}),[l]),function(e,t,n){const r=(0,s.useMemo)((()=>new Set(e)),[e]),[i,o]=(0,s.useState)(""),a=(0,s.useCallback)((({key:e})=>{r.has(e)&&e!==i&&o(e)}),[r,i,t]),l=(0,s.useCallback)((({key:e})=>{e===i&&(o(""),n(e))}),[i,n]);(0,s.useEffect)((()=>(window.addEventListener("keydown",a),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",a),window.removeEventListener("keyup",l)})),[l,a])}(["t","g"],(()=>{}),(e=>{"t"===e?r(U.transpose(1)):"g"===e&&r(U.transpose(-1))}));const u=e=>t=>{e.set(t),i(U.update())};return _("m",u(U.voicings.root[0])),_("j",u(U.voicings.root[1])),_("u",u(U.voicings.root[2])),_(",",u(U.voicings.mid[0])),_("k",u(U.voicings.mid[1])),_("i",u(U.voicings.mid[2])),_(".",u(U.voicings.high[0])),_("l",u(U.voicings.high[1])),_("o",u(U.voicings.high[2])),s.createElement(s.Fragment,null,s.createElement("p",null,"transposition: ",n),s.createElement("p",null,"root: ",U.getRoot().noteString()),s.createElement("p",null,"notes playing: ",e.join(", ")))}function B(){return s.createElement("section",null,s.createElement("h3",null,"About"),s.createElement("p",null,"This is a two-handed instrument. 'asdfqwe' keys on the left hand set the chord root to play, and the 'mju,ki.lo' keys (forming a 3x3 grid on the keyboard) on the right hand control voicing. Right now this just plays triads."),"Controls:",s.createElement("ul",null,s.createElement("li",null,"The 8 chord keys 'asdfqwe' map to the 8 notes of the major scale. They can just be pressed once to set the root for the instrument"),s.createElement("li",null,"'cv' controls sus2, sus4, respectively."),s.createElement("li",null,"'b' controls aug/dim."),s.createElement("li",null,"The three columns, 'mju', ',ki', and '.lo' map to the three notes in the triad (root, third, fifth, respectively). Each key in that column map to low, medium, and high octaves. For example, 'jkl' will play C4, D4, E4. Lowering the 'j' to 'm' will play C3, D4, E4."),s.createElement("li",null,"'t/g' to transpose up/down")))}function q(){return s.createElement(s.Fragment,null,s.createElement(o,null),s.createElement("hr",null),s.createElement(H,null),s.createElement("hr",null),s.createElement(B,null))}const J=document.querySelector("#chorder_container");r.render(s.createElement(q,null),J)}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=t,e=[],s.O=(t,n,r,i)=>{if(!n){var o=1/0;for(c=0;c<e.length;c++){for(var[n,r,i]=e[c],a=!0,l=0;l<n.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,i<o&&(o=i));if(a){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,r,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={346:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[o,a,l]=n,u=0;if(o.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var c=l(s)}for(t&&t(n);u<o.length;u++)i=o[u],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},n=self.webpackChunkhngmn_github_io=self.webpackChunkhngmn_github_io||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=s.O(void 0,[448,852,886],(()=>s(5795)));r=s.O(r)})();